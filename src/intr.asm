extern intr_dispatcher
global intr_stub_size
global intr_stub_start

section .data
bits 64
intr_stub_size:
dd INTR_STUB_SIZE

section .text
bits 64

%macro decl_intr_stub 1
mov rdi, %1
jmp intr_stub
%endmacro

intr_stub:
mov rsi, rsp
call intr_dispatcher
mov rsp, rax
iretq

intr_stub_start:
decl_intr_stub 0
INTR_STUB_SIZE equ $ - intr_stub_start
decl_intr_stub 1
decl_intr_stub 2
decl_intr_stub 3
decl_intr_stub 4
decl_intr_stub 5
decl_intr_stub 6
decl_intr_stub 7
decl_intr_stub 8
decl_intr_stub 9
decl_intr_stub 10
decl_intr_stub 11
decl_intr_stub 12
decl_intr_stub 13
decl_intr_stub 14
decl_intr_stub 15
decl_intr_stub 16
decl_intr_stub 17
decl_intr_stub 18
decl_intr_stub 19
decl_intr_stub 20
decl_intr_stub 21
decl_intr_stub 22
decl_intr_stub 23
decl_intr_stub 24
decl_intr_stub 25
decl_intr_stub 26
decl_intr_stub 27
decl_intr_stub 28
decl_intr_stub 29
decl_intr_stub 30
decl_intr_stub 31
decl_intr_stub 32
decl_intr_stub 33
decl_intr_stub 34
decl_intr_stub 35
decl_intr_stub 36
decl_intr_stub 37
decl_intr_stub 38
decl_intr_stub 39
decl_intr_stub 40
decl_intr_stub 41
decl_intr_stub 42
decl_intr_stub 43
decl_intr_stub 44
decl_intr_stub 45
decl_intr_stub 46
decl_intr_stub 47
decl_intr_stub 48
decl_intr_stub 49
decl_intr_stub 50
decl_intr_stub 51
decl_intr_stub 52
decl_intr_stub 53
decl_intr_stub 54
decl_intr_stub 55
decl_intr_stub 56
decl_intr_stub 57
decl_intr_stub 58
decl_intr_stub 59
decl_intr_stub 60
decl_intr_stub 61
decl_intr_stub 62
decl_intr_stub 63
decl_intr_stub 64
decl_intr_stub 65
decl_intr_stub 66
decl_intr_stub 67
decl_intr_stub 68
decl_intr_stub 69
decl_intr_stub 70
decl_intr_stub 71
decl_intr_stub 72
decl_intr_stub 73
decl_intr_stub 74
decl_intr_stub 75
decl_intr_stub 76
decl_intr_stub 77
decl_intr_stub 78
decl_intr_stub 79
decl_intr_stub 80
decl_intr_stub 81
decl_intr_stub 82
decl_intr_stub 83
decl_intr_stub 84
decl_intr_stub 85
decl_intr_stub 86
decl_intr_stub 87
decl_intr_stub 88
decl_intr_stub 89
decl_intr_stub 90
decl_intr_stub 91
decl_intr_stub 92
decl_intr_stub 93
decl_intr_stub 94
decl_intr_stub 95
decl_intr_stub 96
decl_intr_stub 97
decl_intr_stub 98
decl_intr_stub 99
decl_intr_stub 100
decl_intr_stub 101
decl_intr_stub 102
decl_intr_stub 103
decl_intr_stub 104
decl_intr_stub 105
decl_intr_stub 106
decl_intr_stub 107
decl_intr_stub 108
decl_intr_stub 109
decl_intr_stub 110
decl_intr_stub 111
decl_intr_stub 112
decl_intr_stub 113
decl_intr_stub 114
decl_intr_stub 115
decl_intr_stub 116
decl_intr_stub 117
decl_intr_stub 118
decl_intr_stub 119
decl_intr_stub 120
decl_intr_stub 121
decl_intr_stub 122
decl_intr_stub 123
decl_intr_stub 124
decl_intr_stub 125
decl_intr_stub 126
decl_intr_stub 127
decl_intr_stub 128
decl_intr_stub 129
decl_intr_stub 130
decl_intr_stub 131
decl_intr_stub 132
decl_intr_stub 133
decl_intr_stub 134
decl_intr_stub 135
decl_intr_stub 136
decl_intr_stub 137
decl_intr_stub 138
decl_intr_stub 139
decl_intr_stub 140
decl_intr_stub 141
decl_intr_stub 142
decl_intr_stub 143
decl_intr_stub 144
decl_intr_stub 145
decl_intr_stub 146
decl_intr_stub 147
decl_intr_stub 148
decl_intr_stub 149
decl_intr_stub 150
decl_intr_stub 151
decl_intr_stub 152
decl_intr_stub 153
decl_intr_stub 154
decl_intr_stub 155
decl_intr_stub 156
decl_intr_stub 157
decl_intr_stub 158
decl_intr_stub 159
decl_intr_stub 160
decl_intr_stub 161
decl_intr_stub 162
decl_intr_stub 163
decl_intr_stub 164
decl_intr_stub 165
decl_intr_stub 166
decl_intr_stub 167
decl_intr_stub 168
decl_intr_stub 169
decl_intr_stub 170
decl_intr_stub 171
decl_intr_stub 172
decl_intr_stub 173
decl_intr_stub 174
decl_intr_stub 175
decl_intr_stub 176
decl_intr_stub 177
decl_intr_stub 178
decl_intr_stub 179
decl_intr_stub 180
decl_intr_stub 181
decl_intr_stub 182
decl_intr_stub 183
decl_intr_stub 184
decl_intr_stub 185
decl_intr_stub 186
decl_intr_stub 187
decl_intr_stub 188
decl_intr_stub 189
decl_intr_stub 190
decl_intr_stub 191
decl_intr_stub 192
decl_intr_stub 193
decl_intr_stub 194
decl_intr_stub 195
decl_intr_stub 196
decl_intr_stub 197
decl_intr_stub 198
decl_intr_stub 199
decl_intr_stub 200
decl_intr_stub 201
decl_intr_stub 202
decl_intr_stub 203
decl_intr_stub 204
decl_intr_stub 205
decl_intr_stub 206
decl_intr_stub 207
decl_intr_stub 208
decl_intr_stub 209
decl_intr_stub 210
decl_intr_stub 211
decl_intr_stub 212
decl_intr_stub 213
decl_intr_stub 214
decl_intr_stub 215
decl_intr_stub 216
decl_intr_stub 217
decl_intr_stub 218
decl_intr_stub 219
decl_intr_stub 220
decl_intr_stub 221
decl_intr_stub 222
decl_intr_stub 223
decl_intr_stub 224
decl_intr_stub 225
decl_intr_stub 226
decl_intr_stub 227
decl_intr_stub 228
decl_intr_stub 229
decl_intr_stub 230
decl_intr_stub 231
decl_intr_stub 232
decl_intr_stub 233
decl_intr_stub 234
decl_intr_stub 235
decl_intr_stub 236
decl_intr_stub 237
decl_intr_stub 238
decl_intr_stub 239
decl_intr_stub 240
decl_intr_stub 241
decl_intr_stub 242
decl_intr_stub 243
decl_intr_stub 244
decl_intr_stub 245
decl_intr_stub 246
decl_intr_stub 247
decl_intr_stub 248
decl_intr_stub 249
decl_intr_stub 250
decl_intr_stub 251
decl_intr_stub 252
decl_intr_stub 253
decl_intr_stub 254
decl_intr_stub 255